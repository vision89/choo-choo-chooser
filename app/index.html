<!doctype html>
<html lang="">
	
	<head>

		<!--<link rel="icon" href="assets/favicon.ico" type="image/x-icon" />-->

		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<!-- Web Components -->
		<script src="/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>

		<!-- MDL -->
		<link rel="stylesheet" href="/bower_components/material-design-lite/material.min.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

		<!--Local Styles -->
		<link rel="stylesheet" href="css/styles.css">

		<!-- Papa Parse -->
		<script src="bower_components/xmlToJSON.js/lib/xmlToJSON.js"></script>
		
		<!-- Elements -->
		<link rel="import" href="elements/elements.html">

		<!-- Polyfills -->
		<!--[if IE 8]><script src="/bower_components/EventListener/EventListener.js"></script><!--<![endif]-->
		<!--[if lt IE 8]><script src="/bower_components/EventListener/EventListener.oldie.js"></script><!--<![endif]-->
		<script src="/bower_components/cache-polyfill/index.js"></script>
		
		<!-- Any styles were sharing -->
		<style is="custom-style" include="shared-styles"></style>

		<title>Choo Choo Chooser!</title>

	</head>

	<body class="fullbleed layout vertical" unresolved>

		<template id="app" is="dom-bind">

			<paper-drawer-panel id="paperDrawerPanel" force-narrow="true" disable-edge-swipe="true">

				<paper-header-panel drawer>

					<!-- Drawer Toolbar -->
					<paper-toolbar id="drawerToolbar">

						<span>Menu</span>

					</paper-toolbar>
					
					<!-- Were grabbing values -->
					<template is="dom-if" if="[[loading]]">
						
						<div class="horizontal_center vertical_center">

							<paper-spinner active></paper-spinner>

						</div>

					</template>

					<!-- We have the values -->
					<template is="dom-if" if="[[!loading]]">

						<template is="dom-if" if="[[isDeparture]]"> 

							<!-- Selectable stations go here -->
							<paper-listbox on-iron-select="agencySelected">

								<template is="dom-repeat" items="[[agencyList]]">

									<paper-item value="[[item]]">[[item.agency_name]]</paper-item>

								</template>

							</paper-listbox>

						</template>

						<template is="dom-if" if="[[!isDeparture]]">

							<!-- Were not showing the directions list, so show routes -->
							<template is="dom-if" if="[[!showDirectionsList]]">

								<!-- Selectable routes go here -->
								<paper-listbox id="routelist" on-iron-select="routeSelected">
									
									<template is="dom-if" if="[[!routes.length]]">
								
										<div class="indent">

											No Routes

										</div>

									</template>

									<template is="dom-if" if="[[routes.length]]">

										<template is="dom-repeat" items="[[routes]]">

											<paper-item value="[[item]]">[[item.name]]</paper-item>

										</template>

									</template>

								</paper-listbox>

							</template>
							
							<!-- Show the directions list -->
							<template is="dom-if" if="[[showDirectionsList]]">

								<!-- Selectable directions go here -->
								<paper-listbox id="directionslist" on-iron-select="directionSelected">

									<template is="dom-repeat" items="[[directions]]">

										<paper-item value="[[item]]">[[item.name]]</paper-item>

									</template>

								</paper-listbox>

							</template>

						</template>

					</template>

				</paper-header-panel>
				
				<!-- Top Header -->
				<paper-header-panel main>

					<paper-toolbar id="main-toolbar">

						<div class="middle middle-container">

							Choo Choo Chooser!

						</div>

					</paper-toolbar>

					<div>

						<neon-animated-pages class="flex" selected="[[selected]]">
							
							<map-page on-routes-pressed="populateRoutes" on-departure-pressed="populateDeparture"
							on-directions-pressed="populateDirections" departure="{{departure}}" 
							route="{{selectedRoute.name}}" is-mobile="[[mobile]]" 
							location="[[loc]]" stops="[[stops]]" 
							show-directions="[[showDirections]]" direction="[[selectedDirection.name]]">
							</map-page>

							<schedule-page></schedule-page>
						    
						</neon-animated-pages>
					
					</div>

				</paper-header-panel>

			</paper-drawer-panel>

			<iron-media-query query="(max-width: 767px)" query-matches="{{mobile}}"></iron-media-query>
			
			<!-- Load a new serice worker -->
			<paper-toast id="reloadtoast" duration="13000" text="A new version of Choo Choo Chooser is available, ">

				<paper-button class="pink-button" onclick="[[reloadPage]]">Update!</paper-button>

			</paper-toast>

			<!-- DATA Elements Below -->

			<!-- Bart GTFS File -->
			<gtfs-feed id="bartgtfsfiles" files="[[bartFiles]]" json="{{bartJson}}" on-error="gtfsErrorFiles"></gtfs-feed>	

			<!-- County Connection GTFS File -->
			<gtfs-feed id="countyconnectiongtfsfiles" files="[[countyConnectionFiles]]" json="{{countyConnectionJson}}" on-error="gtfsErrorFiles"></gtfs-feed>	

			<!-- Make caltrain json data from gtfs files -->
			<gtfs-feed id="calgtfsfiles" files="[[calTrainFiles]]" json="{{calJson}}" on-error="gtfsErrorFiles"></gtfs-feed>
			
			<!-- AC Transit GTFS Files -->
			<gtfs-feed id="actransitgtfsfiles" files="[[acTransitFiles]]" json="{{acTransitJson}}" on-error="gtfsErrorFiles"></gtfs-feed>

			<!-- Lavta GTFS Files -->
			<gtfs-feed id="lavtagtfsfiles" files="[[lavtaFiles]]" json="{{lavtaJson}}" on-error="gtfsErrorFiles"></gtfs-feed>	

			<!-- Marin GTFS Files -->
			<gtfs-feed id="maringtfsfiles" files="[[marinFiles]]" json="{{marinJson}}" on-error="gtfsErrorFiles"></gtfs-feed>	

			<!-- Sam Trans GTFS Files -->
			<gtfs-feed id="samtransgtfsfiles" files="[[samTransFiles]]" json="{{samTransJson}}" on-error="gtfsErrorFiles"></gtfs-feed>

			<!-- Santa Rosa CityBus -->
			<gtfs-feed id="srcbfiles" files="[[srcbFiles]]" json="{{srcbJson}}" on-error="gtfsErrorFiles"></gtfs-feed>

			<!-- SFMTA GTFS Files -->
			<gtfs-feed id="sfmtagtfsfiles" files="[[sfmtaFiles]]" json="{{sfmtaJson}}" on-error="gtfsErrorFiles"></gtfs-feed>	

			<!-- VTA GTFS Files -->
			<gtfs-feed id="vtagtfsfiles" files="[[vtaFiles]]" json="{{vtaJson}}" on-error="gtfsErrorFiles"></gtfs-feed>
	
			<!-- General File Parser -->
			<gtfs-feed id="fileParser" files="[[gtfsFile]]" json="{{parsedJson}}" on-error="gtfsErrorFiles"></gtfs-feed>			
			
			<!--
			<gtfs-feed id="gtfsagency" xml="[[agencytext]]" json="{{gtfsJson}}" on-error="gtfsErrorXML"></gtfs-feed>
			<gtfs-feed id="gtfsroutes" xml="[[routestext]]" json="{{gtfsRoutesJson}}" on-error="gtfsErrorXML"></gtfs-feed>
			<gtfs-feed id="gtfsstops" xml="[[stopstext]]" json="{{gtfsStopsJson}}" on-error="gtfsErrorXML"></gtfs-feed>
			-->

		</template>

		<!-- indexeddb shim -->
		<script src="bower_components/IndexedDBShim/dist/indexeddbshim.min.js"></script>

		<!-- IndexedDB Promised -->
		<script src="bower_components/indexeddb-promised/lib/idb.js"></script>

		<!-- File Parser -->
		<script src="bower_components/papaparse/papaparse.min.js"></script>

		<!-- App Logic -->
		<script src="js/all.js"></script>

	</body>

</html>